<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="">
        <meta name="author" content="">
        <link rel="shortcut icon" href="favicon.png">
        <title>Spells Of Genesis Level Editor (alpha preview)</title>

        <!--Core CSS -->
        <link href="http://sandra.everdreamsoft.com/views/bucketadmin/bs3/css/bootstrap.min.css" rel="stylesheet">
        <link href="http://sandra.everdreamsoft.com/views/views/bucketadmin/css/bootstrap-reset.css" rel="stylesheet">
        <link href="http://sandra.everdreamsoft.com/views/views/bucketadmin/assets/font-awesome/css/font-awesome.css" rel="stylesheet" />

        <!-- Custom styles for this template -->
        <link href="http://sandra.everdreamsoft.com/views/views/bucketadmin/css/style.css" rel="stylesheet">
        <link href="http://sandra.everdreamsoft.com/views/views/bucketadmin/css/style-responsive.css" rel="stylesheet" />
        <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
        <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/jquery.slick/1.5.9/slick-theme.css"/>
        <style>
            body{
                background-image:url(http://bitcrystals.com/img/background.jpg);
                background-size: cover;
                background-repeat: no-repeat;
            }
            div{
                background-repeat: no-repeat;
                background-position: 50% 50%;

            }
            section#level-editor{
                display:none;
            }
            table{
                margin:auto;
            }
            h1 span{
                font-size: large;
            }
            .preview{
                position: relative;
                height:528px;
                width:396px;
                border:1px black solid;
                z-index:998;
                background-size: cover;
                margin:auto;
                background-image: url("//sandra.everdreamsoft.com/images/sog_bg_gamecrop.jpg");
            }
            .card-preview {
                background-size: cover;
                background-color: black;
                height: 142px;
                width: 142px;
                z-index:998;
                border: 2px solid white;
                border-radius: 71px;
                top:0px;
                left:-10px;
                position:absolute;
                box-shadow: 5px 5px 5px #000;               
                transition: box-shadow 0.5s;
            }
            .obstacle-preview{

                height: 40px;
                width:  40px;

            }
            .obstacle-preview{
                position: absolute;
                z-index: 998;               
                transition: box-shadow 0.5s;
            }
            .obstacle-preview>div.obstacle-image{
                height: 100%;
                width: 100%;
                background-size: 100% 100%;
            }
            .card-thumb-container{
                height: 122px;
                width: 46px;
            }
            .background-thumb-container{
                height: 120px;
                width:90px;
            }
            #obstacle-list>div{
                height: 50px;
                width: 50px;
            }
            #obstacle-list p {
                bottom: -20px;
                color: black;
                position: absolute;
                text-align: center;
                width: 100%;
            }
            .card-thumb-container,.background-thumb-container,#obstacle-list>div{
                display: inline-block;
                position: relative;
            }
            .card-thumb,.background-thumb,#obstacle-list>div>div{
                background-size: contain;
                background-repeat: no-repeat;                
                display: inline-block;
                height: 100%;
                width: 100%;
                top:0;
                left:0;
                transition: left 0.7s;
                position: absolute;
            }
            .card-thumb:hover,.background-thumb:hover,#obstacle-list>div>div:hover{
                z-index: 999;
                cursor:pointer;
            }
            .card-thumb:hover,.background-thumb:hover{
                box-shadow: 0px 0px 10px 0px #fff;
                height: 200%;
                width: 200%;
                top:-80px;
                left:-20px;
            }
            #obstacle-list>div>div:hover{
                height: 150%;
                width: 150%;
                top:-40px;
                left:-10px;
            }
            #generate-button{
                background-color: green;
            }
            #clear-button{
                background-color: red;
            }
            #generate-button,#clear-button{
                color: white;
                font-size:150%;
                text-align: center;
                padding:20px;
                display: inline-block;
                margin-top: 20px;
                margin-bottom: 20px;
            }
            .ui-draggable-dragging{
                box-shadow: 1px 1px 15px #FFF;
                transition: box-shadow 0.5s;
            }
            #level-description{

            }
            #card-display{                
                height: 447px;
                left: 10px;
                position: absolute;
                top: 160px;
                width: 320px;
                z-index: 999;
                box-shadow: 1px 1px 15px #000;
                display: none;
            }
            #card-display>div{

                height: 100%;
                width: 100%;
                background-size: contain;

            }
            #level-title {
                font-size: 1.5em;
                height: 2em;
                text-align: center;
                width: 600px;
            }
            #level-description {
                height: 8em;
                text-align: left;
                width: 600px;
            }
            #editor-title {
                margin-top: 2em;
            }
        </style>
        <!-- Just for debugging purposes. Don't actually copy this line! -->
        <!--[if lt IE 9]><script src="js/ie8/ie8-responsive-file-warning.js"></script><![endif]-->

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
    </head>
    <body>
        <div class="container">            
            <section id="modal-Åµindows">
                <div id="modal-level-list" class="modal fade">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <h4 class="modal-title">Select the level to load.</h4>
                            </div>
                            <div class="modal-body">

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>                                
                            </div>
                        </div>
                    </div>
                </div>
                <div id="modal-save-dialog" class="modal fade">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <h4 class="modal-title">Save this level.</h4>
                            </div>
                            <div class="modal-body">
                                <p>This level will be saved to your SOG account.</p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="cancel btn btn-secondary" data-dismiss="modal">Close</button>                                
                                <button type="button" class="save btn btn-danger" data-dismiss="modal">Save</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="modal-clear-dialog" class="modal fade">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <h4 class="modal-title">Clear this level.</h4>
                            </div>
                            <div class="modal-body">
                                <p>The current level will be reset</p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="clear btn btn-secondary" data-dismiss="modal">OK</button>                                
                                <button type="button" class="cancel btn btn-danger" data-dismiss="modal">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section  id="editor-title" class="panel text-center">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-12">                               
                            <h1>Spells Of Genesis Level Editor <span>(alpha)</span></h1>
                            <p>This is the Spells Of Genesis Level Editor alpha release!</p>                            
                            <p>To create a level, click on the "New/Clear" button, then click on enemies and obstacles.<br>They will appear on the preview where you can drag them where you want them to be.</p>
                            <p>To remove an enemy or item, just drag it away from the preview.</p>
                            <p>You can load and save levels in your Spells Of Genesis account by clicking on the options buttons (Load and Save).</p>
                            <p>This editor is in beta preview. Please be aware that we will improve it in the near future so you can save as many level as you like.</p>
                            <h3>Have fun !</h3>
                        </div>
                    </div>
                </div>
            </section>
            <section id="level-editor" class="panel text-center">                
                <div class="panel-body">
                    <!--
                    <div class="row">
                        <div class="col-md-12">   
                            <div class="row">
                                <div class="col-md-12">   
                                    <h2>Level designer</h2>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">   
                                    <input type="text" id="level-title" placeholder="Choose a title" required>                            
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">   
                                    <textarea id="level-description" placeholder="Once upon a time..." required></textarea>                         
                                </div>
                            </div>
                        </div>
                    </div>
                    -->
                    <div class="row">
                        <div class="col-md-12" id="backgrounds-list" style="display:none">
                            <h2>Backgrounds</h2>
                            <div id="background-select">                                                
                                <div class="background-thumb-container"><div class="background-thumb" style="background-image:url(http://api.moonga.com/gw_admin/img/levels/generated/background_6.png)"></div></div>
                                <div class="background-thumb-container"><div class="background-thumb" style="background-image:url(http://api.moonga.com/gw_admin/img/levels/generated/background_8.png)"></div></div>
                                <div class="background-thumb-container"><div class="background-thumb" style="background-image:url(http://api.moonga.com/gw_admin/img/levels/generated/background_22.png)"></div></div>                                                
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12" id="enemies-list">
                            <h2>Enemies</h2>                                
                            <div id="cards-carousel"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12" style="" id="items-list">
                            <h2>Items</h2>
                            <div id="obstacle-list">
                                <div data-widget-name="Heart Bonus"><div class="obstacle-image" style="background-image:url('http://api.moonga.com/RCT/cp/app/webroot/img/spells_icons/heart.png')"></div></div>
                                <div data-widget-name="Grey Sword Bonus"><div class="obstacle-image" style="background-image:url('http://api.moonga.com/RCT/cp/app/webroot/img/spells_icons/gray_sword.png')"></div></div>
                                <div data-widget-name="Red Sword Bonus"><div class="obstacle-image" style="background-image:url('http://api.moonga.com/RCT/cp/app/webroot/img/spells_icons/red_sword.png')"></div></div>
                                <div data-widget-name="Bomb Bonus"><div class="obstacle-image" style="background-image:url('http://api.moonga.com/RCT/cp/app/webroot/img/spells_icons/bomb.png')"></div></div>
                                <div data-widget-name="Square Wall"><div class="obstacle-image" style="background-image:url('http://api.moonga.com/RCT/cp/app/webroot/img/spells_icons/square_wall.png')"></div></div>
                                <div data-widget-name="Triangle Wall"><div class="obstacle-image" style="background-image:url('http://api.moonga.com/RCT/cp/app/webroot/img/spells_icons/triangle_wall.png')"></div></div>
                                <div data-widget-name="Circle Wall"><div class="obstacle-image" style="background-image:url('http://api.moonga.com/RCT/cp/app/webroot/img/spells_icons/round_wall.png')"></div></div>
                                <div data-widget-name="Square Breakable"><div class="obstacle-image" style="background-image:url('http://api.moonga.com/RCT/cp/app/webroot/img/spells_icons/square_breakable.png')"></div></div>
                                <div data-widget-name="Triangle Breakable"><div class="obstacle-image" style="background-image:url('http://api.moonga.com/RCT/cp/app/webroot/img/spells_icons/triangle_breakable.png')"></div></div>
                                <div data-widget-name="Circle Breakable"><div class="obstacle-image" style="background-image:url('http://api.moonga.com/RCT/cp/app/webroot/img/spells_icons/circle_breakable.png')"></div></div>
                                <div data-widget-name="Square Healing Well"><div class="obstacle-image" style="background-image:url('http://api.moonga.com/RCT/cp/app/webroot/img/spells_icons/square_heal.png')"></div></div>
                                <div data-widget-name="Triangle Healing Well"><div class="obstacle-image" style="background-image:url('http://api.moonga.com/RCT/cp/app/webroot/img/spells_icons/triangle_heal.png')"></div></div>
                                <div data-widget-name="Circle Healing Well"><div class="obstacle-image" style="background-image:url('http://api.moonga.com/RCT/cp/app/webroot/img/spells_icons/round_heal.png')"></div></div>
                                <div data-widget-name="Square Damage Well"><div class="obstacle-image" style="background-image:url('http://api.moonga.com/RCT/cp/app/webroot/img/spells_icons/square_damage.png')"></div></div>
                                <div data-widget-name="Triangle Damage Well"><div class="obstacle-image" style="background-image:url('http://api.moonga.com/RCT/cp/app/webroot/img/spells_icons/triangle_wall.png')"></div></div>
                                <div data-widget-name="Circle Damage Well"><div class="obstacle-image" style="background-image:url('http://api.moonga.com/RCT/cp/app/webroot/img/spells_icons/round_damage.png')"></div></div>                                
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <h2>Waves</h2>
                            <ul class="nav nav-tabs">
                                <li class="active"><a data-toggle="tab" href="#wave-1-tab">Wave 1</a></li>
                                <li><a data-toggle="tab" href="#wave-2-tab">Wave 2</a></li>
                                <li><a data-toggle="tab" href="#wave-3-tab">Wave 3</a></li>
                            </ul>

                            <div class="tab-content">
                                <div id="wave-1-tab" class="tab-pane fade in active">
                                    <h3>First Wave Preview</h3>
                                    <div class="preview" id="preview-0"></div>
                                    <div id="card-display"></div>
                                </div>
                                <div id="wave-2-tab" class="tab-pane fade">
                                    <h3>Second Wave Preview</h3>
                                    <div class="preview" id="preview-1"></div>

                                </div>
                                <div id="wave-3-tab" class="tab-pane fade">
                                    <h3>Third Wave Preview</h3>
                                    <div class="preview" id="preview-2" ></div>
                                </div>
                            </div>
                        </div>                        
                    </div>                    
                </div>
            </section>
            <section id="editor-options" class="panel text-center">
                <div class="panel-body">
                    <h3>Options</h3>
                    <div>
                        <button type="button" class="clear btn btn-warning">New/Clear</button>
                        <!--<button type="button" class="new btn btn-warning">New</button>-->
                        <button type="button" class="load btn btn-success">Load</button>
                        <button id='save-dialog-button' type="button" class="save btn btn-danger">Save</button>                    
                    </div>
                </div>
            </section>
        </div>
        <script src="http://sandra.everdreamsoft.com/views/bucketadmin/js/lib/jquery.js"></script>
        <script src="http://sandra.everdreamsoft.com/views/bucketadmin/bs3/js/bootstrap.min.js"></script>
        <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
        <script type="text/javascript" src="//cdn.jsdelivr.net/jquery.slick/1.5.9/slick.min.js"></script>


        <script>
            var levelsJson = "";
            var levelsGetUrl = "http://spellsofgenesis.com/api/v4/levels/map.py";
            var userLevelGetUrl = "activateTrigger.php?trigger=59577&loadlevel=1&action=level_editor";
            var levelPostUrl = "activateTrigger.php?trigger=59577&savelevel=1&action=level_editor";
            var cardPreviewOffset = 0;
            $(document).ready(function () {


                //$('#save-dialog-button').prop('disabled', true);
                //Loads olivier's official level list
                /*
                 $.ajax({
                 method: "GET",
                 dataType: "json",
                 url: levelsGetUrl,
                 success: function (response) {
                 levelsJson = response;
                 
                 },
                 failure: function (response) {
                 alert('Error retrieving levels');
                 console.log(response);
                 }
                 });
                 */
                generateEnemyTable();

                $(".preview").droppable({
                    out: function (event, ui) {
                        ui.draggable.remove();
                    }
                });

                $(".preview").on('drop', function (event, ui) {
                    dropElement($(ui));
                });

                $(document)

                        //Create enemy in preview        
                        .on('click', ".card-thumb", function () {

                            createElement($(this));

                        })
                        //Create obstacle in preview
                        .on('click', '#obstacle-list>div', function (e) {
                            $('.active .preview').append($(this).clone().addClass('obstacle-preview').css('top', cardPreviewOffset).attr('data-pos-x', -90).attr('data-pos-y', -110));
                            $('.obstacle-preview').draggable();
                            $('.obstacle-preview').resizable({
                                handles: 'e,s'
                            });
                            //cardPreviewOffset += 20;
                        })
                        //Generate the Json
                        .on('click', "#modal-save-dialog .save", function (e) {
                            e.preventDefault();
                            var theJson = generateJson();


                            $.ajax({
                                type: "POST",
                                /*contentType: "application/json",*/
                                url: levelPostUrl,
                                data: {'level': theJson},
                                success: function (response) {
                                    alert('Your level has been saved !');
                                    console.log(response);
                                },
                                error: function (response) {
                                    alert('There was an error saving the level.');
                                    console.log(response);
                                }
                            });


                        })
                        //Clicked on the load level button
                        //Populates ands display the modal window to load the level
                        //There was a list once in the past. remember. That's why code is in comments
                        .on('click', '#editor-options .load', function (e) {
                            $.ajax({
                                method: "GET",
                                dataType: "json",
                                url: userLevelGetUrl,
                                success: function (response) {
                                    levelsJson = response;
                                    console.log('loaded level : ');
                                    console.log(response);
                                    $('#level-editor').fadeIn();
                                    $('#modal-level-list').modal('hide');
                                    clearPreview();
                                    loadJson(JSON.parse(response));
                                    //toggleButtonsState();


                                },
                                failure: function (response) {
                                    alert('Error retrieving levels');
                                    console.log(response);
                                }
                            });
                            /*
                             $.each(levelsJson.levels, function (i, obj) {
                             
                             var newLevel = "<div><span><a class='level-link' href='#' data-level-num='" + i + "'>" + obj.name + "</a></span> - <span>" + obj.description + "</span></div>";
                             $('#modal-level-list .modal-body').append(newLevel);
                             });
                             $('#modal-level-list').modal();
                             */
                        })
                        //do load the level
                        .on('click', '#modal-level-list a', function (e) {

                            e.preventDefault();
                            $('#level-editor').fadeIn();
                            $('#modal-level-list').modal('hide');
                            clearPreview();
                            loadJson($(this).data('level-num'));
                            //toggleButtonsState();
                        })
                        .on('click', '#editor-options .save', function (e) {
                            $('#modal-save-dialog').modal();
                        })
                        .on('click', '#editor-options .clear', function (e) {
                            $('#modal-clear-dialog').modal();
                        })
                        //Clear the preview
                        .on('click', "#modal-clear-dialog .clear", function (e) {
                            e.preventDefault();
                            clearPreview();
                            $('#level-editor').fadeIn();
                            //toggleButtonsState();
                        })
                        //Display the full card
                        .on('click', '.card-preview', function (e) {
                            $('#card-display').empty().append($('<div style="background-image:url(http://api.moonga.com/RCT/cp/cards/view/normal/large/en/' + $(this).attr('data-card-id') + '.jpg)"></div>').attr('data-card-id', $(this).attr('data-card-id'))).fadeIn();
                        })
                        //Clear the full card display
                        .on('click', '#card-display,#clear-button,.card-thumb,.obstacle-preview,#generate-button', function (e) {
                            $('#card-display').fadeOut(function () {
                                $(this).empty();
                            });
                        })
                        //.on('change', 'input, textarea', function (event) {
                        //    toggleButtonsState();
                        //})
                        ;
            });
            var cardsJson = //sogCards//;

                    console.log(''); //I know I know... the fact is that sandra screws up formatting without that one...
            var loadJson = function (level) {

                clearPreview();

                //var level = levelsJson.levels[levelId];
                //Load infos
                //$('#level-title').val(level.name);
                //$('#level-description').val(level.description);
                $('#level-title').val('custom-level');
                $('#level-description').val('generated custom level');
                //Load enemies
                $.each(level.rounds, function (i, round) {
                    if (round.enemies) {
                        $.each(round.enemies, function (j, object) {

                            var selectedCard = $('*[data-id="' + object.card_id + '"]').first();
                            var newElement = selectedCard.clone();

                            newElement.removeClass();
                            newElement.data('pos-x', object.position.x);
                            newElement.data('pos-y', object.position.y);
                            newElement.addClass('card-preview');
                            newElement.css('background-image', 'url(http://api.moonga.com/gw_admin/img/cards/generated/card_' + newElement.attr("data-card-id") + '_big.jpg');
                            newElement.draggable();
                            var size = getEnemySize(getEnemyScale(newElement.attr('data-health')));
                            var radius = size * 2;
                            newElement.css('height', size);
                            newElement.css('width', size);
                            newElement.css('border-radius', radius);
                            object.size = {x: size, y: size};
                            position = gameToWebPos(object);
                            newElement.css({top: position.y, left: position.x});
                            $('#preview-' + i).append(newElement);


                        });
                    }
                    //Load widgets
                    if (round.widgets) {
                        $.each(round.widgets, function (j, widget) {

                            var selectedWidget = $('*[data-widget-name="' + widget.prefab + '"]').first();
                            var newWidget = selectedWidget.clone();

                            newWidget.removeClass();
                            newWidget.draggable();
                            newWidget.addClass('obstacle-preview');
                            newWidget.data('pos-x', widget.position.x);
                            newWidget.data('pos-y', widget.position.y);
                            position = gameToWebPos(widget);
                            size = gameToWebSize(widget);
                            newWidget.css({top: position.y, left: position.x});
                            newWidget.css({height: size.y, width: size.x});
                            $('#preview-' + i).append(newWidget);

                        });
                    }
                });
            };
            var toggleButtonsState = function () {
                $('#save-dialog-button').prop('disabled', ($('#level-title').val() === '' || $('#level-description').val() === ''));
            };
            var generateJson = function () {

                levelJson = {
                    name: $('custom-level').val(),
                    description: $('generated-custom-level').val(),
                    rounds: []
                };

                var waves = $('.preview');
                $.each(waves, function (i, wave) {

                    var obstacles = $(wave).find('.obstacle-preview');
                    var enemies = $(wave).find('.card-preview');

                    levelJson.rounds[i] = {};
                    levelJson.rounds[i].enemies = [];
                    levelJson.rounds[i].widgets = [];

                    $.each(enemies, function (j, domEnemy) {

                        var gamePos = webToGamePos($(domEnemy));

                        var enemy = {
                            card_id: $(domEnemy).data('id'),
                            position:
                                    {
                                        x: gamePos.x,
                                        y: gamePos.y
                                    }
                        };
                        levelJson.rounds[i].enemies.push(enemy);
                    });

                    $.each(obstacles, function (j, domObstacle) {
                        var gamePos = webToGamePos($(domObstacle));
                        var gameSize = webToGameSize($(domObstacle));
                        var obstacle = {
                            prefab: $(domObstacle).data('widget-name'),
                            position:
                                    {
                                        x: gamePos.x,
                                        y: gamePos.y
                                    },
                            size:
                                    {
                                        x: gameSize.x,
                                        y: gameSize.y
                                    }
                        };
                        levelJson.rounds[i].widgets.push(obstacle);
                    });

                });
                return levelJson;
            };

            var dropElement = function (element /*, position*/) {

                var size = getEnemySize(getEnemyScale(element.attr('data-health')));
                var radius = size * 2;
                element.css({
                    'height': size,
                    'width': size,
                    'border-radius': radius
                });

            };
            var createElement = function (element) {

                var selectedCard = element;
                var newElement = selectedCard.clone();

                newElement.removeClass();
                newElement.addClass('card-preview');
                newElement.css('background-image', 'url(http://api.moonga.com/gw_admin/img/cards/generated/card_' + selectedCard.attr("data-card-id") + '_big.jpg');
                newElement.css('top', cardPreviewOffset);
                newElement.draggable();

                $('.active .preview').append(newElement);
                $('.active .preview').trigger("drop", newElement);
                //cardPreviewOffset += 20;

            };


            var generateEnemyTable = function () {

                $(cardsJson).each(function () {
                    var card = $(this)[0];
                    $('#cards-carousel').append('<div class="card-thumb-container"><div class="card-thumb-info"></div><div class="card-thumb" data-card-id="' + card.card_id + '" data-id="' + card.id + '" data-health="' + card.solidity + '" style="background-image:url(http://api.moonga.com/gw_admin/img/cards/generated/card_' + card.card_id + '_small.jpg)" ></div></div>');
                });
            };
            var getEnemyScale = function (health) {

                return 35 + Math.pow(health, 0.6) * 10;
            };
            var getEnemySize = function (scale) {

                return parseFloat(scale) * 1.40;
            };
            var clearPreview = function () {

                $('#level-title, #level-description').val("");
                $('.card-preview, .obstacle-preview').fadeOut(function () {
                    $(this).remove();
                });
                //cardPreviewOffset = 0;
            };

            var webScreenWidth = 396; //automatiser ca en attrapant la largeur
            var gameVirtualSize = {x: 278, y: 380};
            var gameVirtualCenter = {x: 0, y: 32};
            var gameVirtualSizeRatio = gameVirtualSize.y / gameVirtualSize.x;

            var webToGameSize = function (object) {

                var widgetName = object.data('widget-name');
                var x = 1;
                var y = 1;

                if (!widgetName.includes("Bonus")) {

                    var webPos = {x: parseFloat(object.css('width')), y: parseFloat(object.css('height'))};

                    x = webPos.x / webScreenWidth * gameVirtualSize.x;
                    y = webPos.y / webScreenWidth / gameVirtualSizeRatio * gameVirtualSize.y;
                }

                return ({x: x, y: y});

            };

            var gameToWebSize = function (object) {

                var x = 50;
                var y = 50;

                if (!object.prefab.includes("Bonus")) {
                    x = object.size.x / gameVirtualSize.x * webScreenWidth;
                    y = object.size.y / gameVirtualSize.y * webScreenWidth * gameVirtualSizeRatio;
                }

                return ({x: x, y: y});

            };
            //export to game
            var webToGamePos = function (object)
            {
                var objectHeight = parseFloat(object.css('height'));
                var objectWidth = parseFloat(object.css('width'));
                var webPos = {x: parseFloat(object.css('left')), y: parseFloat(object.css('top'))};
                webPos.x += objectWidth / 2;
                webPos.y += objectHeight / 2;

                var x = ((webPos.x / webScreenWidth - 0.5) * gameVirtualSize.x + gameVirtualCenter.x);
                var y = -1 * (webPos.y / webScreenWidth / gameVirtualSizeRatio - 0.5) * gameVirtualSize.y + gameVirtualCenter.y;

                return ({x: x, y: y});
            };
            //import from game
            var gameToWebPos = function (object)
            {
                gamePos = object.position;
                var x = (((gamePos.x - gameVirtualCenter.x) / gameVirtualSize.x + 0.5) * webScreenWidth) - (object.size.x / 2);
                var y = ((-1 * (gamePos.y - gameVirtualCenter.y) / gameVirtualSize.y + 0.5) * webScreenWidth * gameVirtualSizeRatio) - (object.size.y / 2);

                return ({x: x, y: y});
            };

            //ratio zone taille ecran 1.37 (h/w)
        </script>        
    </body>
</html>